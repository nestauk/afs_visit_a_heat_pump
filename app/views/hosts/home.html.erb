<div class="flex flex-wrap gap-8 mt-6">
  <section class="w-full lg:w-1/3 ">
    <div class="p-6 text-white bg-indigo-600">
      <h1>Welcome <%= current_user.first_name %></h1>

      <%- if @host %>
        <%= link_to 'View public profile', @host, class: 'btn bg-white text-indigo-600 w-full mb-4' %>
        <%= link_to 'Edit profile', edit_host_path(@host), class: 'btn bg-white text-indigo-600 w-full' %>
      <% else %>
        <p class="text-lg">
          <%= link_to 'Complete your profile', new_host_path, class: 'link' %>
          to get started.
        </p>
      <% end %>
    </div>
  </section>

  <section class="grow">
    <div class="flex justify-between items-baseline mb-2">
      <h2>My events</h2>
      <%- if @host %>
        <%= link_to 'Add event', new_host_event_path(@host), class: 'btn bg-indigo-600 text-white' %>
      <% end %>
    </div>

    <div class="my-4">
      <strong>Upcoming events</strong>
      <span class="mx-2">&middot;</span>
      <span class="link">Past events</span>
      <span class="mx-2">&middot;</span>
      <span class="link">Cancelled events</span>
    </div>

    <%- if @host %>

      <% if @events.any? %>
      <% else %>
        <div class="flex flex-col items-center justify-center h-64">
          <%= image_tag 'calendar-icon.svg', alt: 'Grey calendar icon', width: 150, height: 150 %>
          <div class="text-gray-600">No events, try add one.</div>
        </div>
      <% end %>

      <%- @events.each do |e| %>
        <div class="border-2 border-indigo-600 mb-6">
          <div class="bg-indigo-600 text-white p-4">
            <div class="flex justify-between items-start">
              <h2><%= e.date.strftime("%A %d %b %G") %></h2>
              <%= link_to 'Edit', edit_host_event_path(@host, e), class: 'btn-sm bg-white text-indigo-600' %>
            </div>

            <p class="flex items-center">
              <%= e.start_at.strftime("%H:%M") %> - <%= e.end_at.strftime("%H:%M") %>
              <span class="mx-2">&middot;</span>
              <%= image_tag 'ticket-icon-white.svg', alt: 'White ticket icon', width: 24, height: 24 %>
              <strong><%= e.bookings.count %></strong>&nbsp;of&nbsp;<strong><%= e.capacity %></strong>&nbsp;bookings
            </p>
          </div>

          <% if e.bookings.any? %>
            <details>
              <summary class="px-4 py-3 text-sm link no-underline hover:bg-indigo-100">
                View bookings
              </summary>
              <div>
                <%- e.bookings.each do |b| %>
                  <p class="px-4 py-3 border-t border-gray-400">
                    <strong><%= b.full_name.titleize %></strong> booked a visit for <strong><%= b.quantity %></strong> people at <%= b.updated_at.strftime("%H:%M on %d %b %G") %>.
                  </p>
                  <% if b.notes.present? %>
                    <p class="px-4 mb-3 text-gray-600 text-sm"><strong>Notes:</strong> <%= b.notes %></p>
                  <% end %>
                <% end %>
              </div>
            </details>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <div class="flex flex-col items-center justify-center h-64">
        <%= image_tag 'calendar-icon.svg', alt: 'Grey calendar icon', width: 150, height: 150 %>
        <div class="text-gray-600">Complete your profile to add events.</div>
      </div>
    <% end %>
  </section>
</div>
